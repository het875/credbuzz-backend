{
	"info": {
		"_postman_id": "password-reset-2026",
		"name": "CredBuzz Password Reset & Change Flows",
		"description": "Complete password reset and change flows implementing OTP-First security model.\n\n**FLOW A**: Forgot Password (Unauthenticated) - OTP + reset_token\n**FLOW B**: Profile Password Change (Authenticated) - access_token + OTP",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{access_token}}",
				"type": "string"
			}
		]
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://127.0.0.1:8000/api/auth-user",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "test_email",
			"value": "user@example.com",
			"type": "string"
		},
		{
			"key": "otp_code",
			"value": "",
			"type": "string"
		},
		{
			"key": "reset_token",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "FLOW A: Forgot Password (Unauthenticated)",
			"item": [
				{
					"name": "1. Request Password Reset OTP",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Save OTP from response (DEBUG mode only)",
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.debug_otp) {",
									"        pm.collectionVariables.set('otp_code', jsonData.data.debug_otp);",
									"        console.log('OTP saved:', jsonData.data.debug_otp);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/forgot-password/",
							"host": ["{{base_url}}"],
							"path": ["forgot-password", ""]
						},
						"description": "**Step 1 of FLOW A: Forgot Password (Unauthenticated)**\n\nSends a 6-digit OTP to the user's email address.\n\n**Authentication**: None required\n\n**OTP Validity**: 10 minutes\n\n**Max Attempts**: 5\n\n**Security**: Always returns success to prevent email enumeration"
					},
					"response": []
				},
				{
					"name": "2. Verify OTP & Get reset_token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Save reset_token from response",
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.reset_token) {",
									"        pm.collectionVariables.set('reset_token', jsonData.data.reset_token);",
									"        console.log('Reset token saved');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\",\n  \"otp_code\": \"{{otp_code}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/verify-forgot-password-otp/",
							"host": ["{{base_url}}"],
							"path": ["verify-forgot-password-otp", ""]
						},
						"description": "**Step 2 of FLOW A: Forgot Password (Unauthenticated)**\n\nVerifies the OTP code and returns a short-lived reset_token.\n\n**Authentication**: None required\n\n**reset_token Validity**: 15 minutes\n\n**OTP Clearance**: OTP is cleared after successful verification\n\n**Security**: OTP cannot be reused"
					},
					"response": []
				},
				{
					"name": "3. Reset Password with Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"reset_token\": \"{{reset_token}}\",\n  \"new_password\": \"NewSecure@123\",\n  \"confirm_password\": \"NewSecure@123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/reset-password-with-token/",
							"host": ["{{base_url}}"],
							"path": ["reset-password-with-token", ""]
						},
						"description": "**Step 3 of FLOW A: Forgot Password (Unauthenticated)**\n\nResets the password using the reset_token obtained from OTP verification.\n\n**Authentication**: None required (reset_token provides authorization)\n\n**Password Requirements**:\n- Minimum 8 characters\n- At least one uppercase letter\n- At least one lowercase letter\n- At least one digit\n\n**Security Actions**:\n- Token marked as used\n- All user sessions invalidated\n- Confirmation email sent"
					},
					"response": []
				},
				{
					"name": "4. Resend Password Reset OTP",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Save OTP from response (DEBUG mode only)",
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.debug_otp) {",
									"        pm.collectionVariables.set('otp_code', jsonData.data.debug_otp);",
									"        console.log('New OTP saved:', jsonData.data.debug_otp);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/resend-password-reset-otp/",
							"host": ["{{base_url}}"],
							"path": ["resend-password-reset-otp", ""]
						},
						"description": "**Optional: Resend OTP if expired or not received**\n\n**Rate Limiting**: Maximum 3 OTPs per 15 minutes"
					},
					"response": []
				}
			],
			"description": "**FLOW A: Forgot Password (Unauthenticated)**\n\nFor users who forgot their password at the login screen.\n\n**Flow**:\n1. Request OTP → Email\n2. Verify OTP → Get reset_token\n3. Reset password with reset_token\n\n**Security**:\n- No authentication required\n- OTP proves email ownership\n- reset_token provides temporary authorization\n- All sessions invalidated after reset"
		},
		{
			"name": "FLOW B: Profile Password Change (Authenticated)",
			"item": [
				{
					"name": "1. Login (Get Access Token)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Save access token from response",
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.access_token) {",
									"        pm.collectionVariables.set('access_token', jsonData.data.access_token);",
									"        console.log('Access token saved');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"identifier\": \"{{test_email}}\",\n  \"password\": \"YourCurrentPassword123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/login/",
							"host": ["{{base_url}}"],
							"path": ["login", ""]
						},
						"description": "**Prerequisite: Login to get access token**\n\nRequired before using profile password change flow."
					},
					"response": []
				},
				{
					"name": "2. Send OTP for Profile Action",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Save OTP from response (DEBUG mode only)",
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.debug_otp) {",
									"        pm.collectionVariables.set('otp_code', jsonData.data.debug_otp);",
									"        console.log('OTP saved:', jsonData.data.debug_otp);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"action_type\": \"PASSWORD_CHANGE\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/profile/send-otp/",
							"host": ["{{base_url}}"],
							"path": ["profile", "send-otp", ""]
						},
						"description": "**Step 1 of FLOW B: Profile Password Change (Authenticated)**\n\nSends OTP for step-up authentication.\n\n**Authentication**: Bearer token required\n\n**OTP Validity**: 5 minutes (shorter for security)\n\n**Max Attempts**: 3 (stricter than forgot flow)\n\n**Action Types**:\n- PASSWORD_CHANGE\n- PROFILE_UPDATE"
					},
					"response": []
				},
				{
					"name": "3. Verify OTP",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"otp_code\": \"{{otp_code}}\",\n  \"action_type\": \"PASSWORD_CHANGE\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/profile/verify-otp/",
							"host": ["{{base_url}}"],
							"path": ["profile", "verify-otp", ""]
						},
						"description": "**Step 2 of FLOW B: Profile Password Change (Authenticated)**\n\nVerifies OTP for authenticated user.\n\n**Authentication**: Bearer token required\n\n**OTP Behavior**: Remains active briefly for user to complete action\n\n**Security**: Requires both access_token AND valid OTP"
					},
					"response": []
				},
				{
					"name": "4. Change Password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"new_password\": \"NewSecure@456\",\n  \"confirm_password\": \"NewSecure@456\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/profile/change-password/",
							"host": ["{{base_url}}"],
							"path": ["profile", "change-password", ""]
						},
						"description": "**Step 3 of FLOW B: Profile Password Change (Authenticated)**\n\nChanges password after OTP verification.\n\n**Authentication**: Bearer token required\n\n**Prerequisite**: OTP must be verified within last 5 minutes\n\n**Password Requirements**:\n- Minimum 8 characters\n- At least one uppercase letter\n- At least one lowercase letter\n- At least one digit\n\n**Security Actions**:\n- OTP cleared after change\n- Current session remains active\n- Confirmation email sent"
					},
					"response": []
				}
			],
			"description": "**FLOW B: Profile Password Change (Authenticated)**\n\nFor logged-in users changing password from profile settings.\n\n**Flow**:\n1. Login → Get access_token\n2. Send OTP → Email\n3. Verify OTP\n4. Change password\n\n**Security**:\n- Authentication required (Bearer token)\n- OTP adds step-up authentication\n- Shorter OTP expiry (5 min)\n- Stricter attempt limits (3)\n- Current session preserved"
		},
		{
			"name": "Legacy Endpoints (Deprecated)",
			"item": [
				{
					"name": "OLD: Direct Reset Password (OTP only)",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\",\n  \"otp_code\": \"{{otp_code}}\",\n  \"new_password\": \"NewPassword@123\",\n  \"confirm_password\": \"NewPassword@123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/reset-password/",
							"host": ["{{base_url}}"],
							"path": ["reset-password", ""]
						},
						"description": "⚠️ **DEPRECATED**: Use new 2-step flow instead\n\nOld endpoint that verified OTP and reset password in one call.\n\n**Recommended**: Use `/verify-forgot-password-otp/` + `/reset-password-with-token/`"
					},
					"response": []
				},
				{
					"name": "OLD: Change Password (No OTP)",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"current_password\": \"OldPassword@123\",\n  \"new_password\": \"NewPassword@123\",\n  \"confirm_password\": \"NewPassword@123\",\n  \"logout_others\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}/change-password/",
							"host": ["{{base_url}}"],
							"path": ["change-password", ""]
						},
						"description": "⚠️ **DEPRECATED**: Use profile flow with OTP instead\n\nOld endpoint that changed password without OTP verification.\n\n**Recommended**: Use `/profile/send-otp/` → `/profile/verify-otp/` → `/profile/change-password/`"
					},
					"response": []
				}
			],
			"description": "**Legacy Endpoints**\n\nKept for backward compatibility but should be migrated to new flows.\n\n⚠️ **Deprecation Timeline**:\n- Phase 1 (Months 0-3): Both old and new endpoints active\n- Phase 2 (Months 3-6): Old endpoints marked deprecated\n- Phase 3 (Month 6+): Old endpoints removed"
		}
	]
}
