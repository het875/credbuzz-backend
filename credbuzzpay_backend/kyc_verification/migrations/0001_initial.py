# Generated by Django 5.2.8 on 2025-12-04 18:40

import django.core.validators
import django.db.models.deletion
import kyc_verification.models
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('users_auth', '0004_add_soft_delete_fields'),
    ]

    operations = [
        migrations.CreateModel(
            name='KYCApplication',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('application_id', models.CharField(editable=False, max_length=20, unique=True)),
                ('status', models.CharField(choices=[('NOT_STARTED', 'Not Started'), ('IN_PROGRESS', 'In Progress'), ('SUBMITTED', 'Submitted'), ('UNDER_REVIEW', 'Under Review'), ('APPROVED', 'Approved'), ('REJECTED', 'Rejected'), ('RESUBMIT', 'Resubmission Required')], default='NOT_STARTED', max_length=20)),
                ('mega_step', models.CharField(choices=[('IDENTITY_PROOF', 'Identity Proof'), ('SELFIE_AND_BUSINESS', 'Selfie & Business Address'), ('COMPLETED', 'All Steps Completed')], default='IDENTITY_PROOF', max_length=30)),
                ('current_step', models.PositiveSmallIntegerField(default=1)),
                ('total_steps', models.PositiveSmallIntegerField(default=8)),
                ('completion_percentage', models.PositiveSmallIntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('review_remarks', models.TextField(blank=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('is_email_verified', models.BooleanField(default=False)),
                ('is_phone_verified', models.BooleanField(default=False)),
                ('email_verified_at', models.DateTimeField(blank=True, null=True)),
                ('phone_verified_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('reviewed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reviewed_kyc_applications', to='users_auth.user')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='kyc_application', to='users_auth.user')),
            ],
            options={
                'verbose_name': 'KYC Application',
                'verbose_name_plural': 'KYC Applications',
                'db_table': 'kyc_application',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='IdentityProof',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('aadhaar_number_encrypted', models.CharField(blank=True, max_length=255)),
                ('aadhaar_name', models.CharField(blank=True, max_length=100)),
                ('aadhaar_dob', models.DateField(blank=True, null=True)),
                ('aadhaar_address', models.TextField(blank=True)),
                ('aadhaar_front_image', models.ImageField(blank=True, null=True, upload_to=kyc_verification.models.aadhaar_front_path, validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['jpg', 'jpeg', 'png', 'pdf']), kyc_verification.models.validate_file_size])),
                ('aadhaar_back_image', models.ImageField(blank=True, null=True, upload_to=kyc_verification.models.aadhaar_back_path, validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['jpg', 'jpeg', 'png', 'pdf']), kyc_verification.models.validate_file_size])),
                ('aadhaar_verified', models.BooleanField(default=False)),
                ('aadhaar_submitted_at', models.DateTimeField(blank=True, null=True)),
                ('pan_number_encrypted', models.CharField(blank=True, max_length=255)),
                ('pan_name', models.CharField(blank=True, max_length=100)),
                ('pan_dob', models.DateField(blank=True, null=True)),
                ('pan_father_name', models.CharField(blank=True, max_length=100)),
                ('pan_image', models.ImageField(blank=True, null=True, upload_to=kyc_verification.models.pan_image_path, validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['jpg', 'jpeg', 'png', 'pdf']), kyc_verification.models.validate_file_size])),
                ('pan_verified', models.BooleanField(default=False)),
                ('pan_submitted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('kyc_application', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='identity_proof', to='kyc_verification.kycapplication')),
            ],
            options={
                'verbose_name': 'Identity Proof',
                'verbose_name_plural': 'Identity Proofs',
                'db_table': 'kyc_identity_proof',
            },
        ),
        migrations.CreateModel(
            name='BusinessDetails',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('business_name', models.CharField(blank=True, max_length=200)),
                ('business_type', models.CharField(blank=True, max_length=100)),
                ('business_phone', models.CharField(blank=True, max_length=10, validators=[django.core.validators.RegexValidator(message='Phone number must be exactly 10 digits.', regex='^\\d{10}$')])),
                ('business_email', models.EmailField(blank=True, max_length=254)),
                ('address_line_1', models.CharField(blank=True, max_length=255)),
                ('address_line_2', models.CharField(blank=True, max_length=255)),
                ('address_line_3', models.CharField(blank=True, max_length=255)),
                ('landmark', models.CharField(blank=True, max_length=200)),
                ('city', models.CharField(blank=True, max_length=100)),
                ('district', models.CharField(blank=True, max_length=100)),
                ('state', models.CharField(blank=True, max_length=100)),
                ('pincode', models.CharField(blank=True, max_length=6, validators=[django.core.validators.RegexValidator(message='Pincode must be exactly 6 digits.', regex='^\\d{6}$')])),
                ('country', models.CharField(default='India', max_length=100)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('kyc_application', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='business_details', to='kyc_verification.kycapplication')),
            ],
            options={
                'verbose_name': 'Business Details',
                'verbose_name_plural': 'Business Details',
                'db_table': 'kyc_business_details',
            },
        ),
        migrations.CreateModel(
            name='BankDetails',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('account_holder_name', models.CharField(blank=True, max_length=200)),
                ('account_number_encrypted', models.CharField(blank=True, max_length=255)),
                ('confirm_account_number_encrypted', models.CharField(blank=True, max_length=255)),
                ('ifsc_code', models.CharField(blank=True, max_length=11, validators=[django.core.validators.RegexValidator(message='IFSC code must be in format: ABCD0XXXXXX', regex='^[A-Z]{4}0[A-Z0-9]{6}$')])),
                ('account_type', models.CharField(choices=[('SAVINGS', 'Savings Account'), ('CURRENT', 'Current Account')], default='SAVINGS', max_length=20)),
                ('bank_name', models.CharField(blank=True, max_length=200)),
                ('branch_name', models.CharField(blank=True, max_length=200)),
                ('branch_address', models.TextField(blank=True)),
                ('bank_document', models.ImageField(blank=True, help_text='Cancelled cheque or passbook front page', null=True, upload_to=kyc_verification.models.bank_document_path, validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['jpg', 'jpeg', 'png', 'pdf']), kyc_verification.models.validate_file_size])),
                ('is_verified', models.BooleanField(default=False)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('kyc_application', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='bank_details', to='kyc_verification.kycapplication')),
            ],
            options={
                'verbose_name': 'Bank Details',
                'verbose_name_plural': 'Bank Details',
                'db_table': 'kyc_bank_details',
            },
        ),
        migrations.CreateModel(
            name='KYCAuditLog',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('action', models.CharField(choices=[('KYC_STARTED', 'KYC Started'), ('STEP_COMPLETED', 'Step Completed'), ('KYC_SUBMITTED', 'KYC Submitted'), ('STATUS_CHANGED', 'Status Changed'), ('DOCUMENT_UPLOADED', 'Document Uploaded'), ('DOCUMENT_UPDATED', 'Document Updated'), ('ADMIN_REVIEW', 'Admin Review'), ('ADMIN_APPROVED', 'Admin Approved'), ('ADMIN_REJECTED', 'Admin Rejected'), ('RESUBMIT_REQUESTED', 'Resubmit Requested')], max_length=30)),
                ('old_status', models.CharField(blank=True, max_length=20)),
                ('new_status', models.CharField(blank=True, max_length=20)),
                ('remarks', models.TextField(blank=True)),
                ('data_changed', models.JSONField(blank=True, default=dict)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('kyc_application', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='audit_logs', to='kyc_verification.kycapplication')),
                ('performed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='kyc_audit_actions', to='users_auth.user')),
            ],
            options={
                'verbose_name': 'KYC Audit Log',
                'verbose_name_plural': 'KYC Audit Logs',
                'db_table': 'kyc_audit_log',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='KYCProgressTracker',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('step_name', models.CharField(max_length=50)),
                ('step_number', models.PositiveSmallIntegerField()),
                ('mega_step', models.CharField(choices=[('IDENTITY_PROOF', 'Identity Proof'), ('SELFIE_AND_BUSINESS', 'Selfie & Business Address'), ('COMPLETED', 'All Steps Completed')], max_length=30)),
                ('status', models.CharField(choices=[('NOT_STARTED', 'Not Started'), ('IN_PROGRESS', 'In Progress'), ('COMPLETED', 'Completed'), ('NEEDS_CORRECTION', 'Needs Correction')], default='NOT_STARTED', max_length=20)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('data_snapshot', models.JSONField(blank=True, default=dict)),
                ('needs_correction', models.BooleanField(default=False)),
                ('correction_remarks', models.TextField(blank=True)),
                ('kyc_application', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='progress_steps', to='kyc_verification.kycapplication')),
            ],
            options={
                'verbose_name': 'KYC Progress Step',
                'verbose_name_plural': 'KYC Progress Steps',
                'db_table': 'kyc_progress_tracker',
                'ordering': ['step_number'],
            },
        ),
        migrations.CreateModel(
            name='OTPVerification',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('otp_type', models.CharField(choices=[('EMAIL', 'Email Verification'), ('PHONE', 'Phone Verification'), ('LOGIN', 'Login Verification'), ('PASSWORD_RESET', 'Password Reset')], default='EMAIL', max_length=20)),
                ('otp_code', models.CharField(max_length=6)),
                ('is_verified', models.BooleanField(default=False)),
                ('attempts', models.PositiveSmallIntegerField(default=0)),
                ('max_attempts', models.PositiveSmallIntegerField(default=3)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField()),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='otp_verifications', to='users_auth.user')),
            ],
            options={
                'verbose_name': 'OTP Verification',
                'verbose_name_plural': 'OTP Verifications',
                'db_table': 'kyc_otp_verification',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='VerificationImages',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('selfie_image', models.ImageField(blank=True, null=True, upload_to=kyc_verification.models.selfie_path, validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['jpg', 'jpeg', 'png']), kyc_verification.models.validate_file_size])),
                ('selfie_submitted_at', models.DateTimeField(blank=True, null=True)),
                ('selfie_verified', models.BooleanField(default=False)),
                ('office_sitting_image', models.ImageField(blank=True, help_text='Photo of you sitting inside your office/workplace', null=True, upload_to=kyc_verification.models.office_sitting_path, validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['jpg', 'jpeg', 'png']), kyc_verification.models.validate_file_size])),
                ('office_door_image', models.ImageField(blank=True, help_text='Photo of office entrance/door with name board', null=True, upload_to=kyc_verification.models.office_door_path, validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['jpg', 'jpeg', 'png']), kyc_verification.models.validate_file_size])),
                ('office_photos_submitted_at', models.DateTimeField(blank=True, null=True)),
                ('office_photos_verified', models.BooleanField(default=False)),
                ('address_proof_image', models.ImageField(blank=True, help_text='Utility bill, rental agreement, or other address proof', null=True, upload_to=kyc_verification.models.address_proof_path, validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['jpg', 'jpeg', 'png', 'pdf']), kyc_verification.models.validate_file_size])),
                ('address_proof_type', models.CharField(blank=True, max_length=50)),
                ('address_proof_submitted_at', models.DateTimeField(blank=True, null=True)),
                ('address_proof_verified', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('kyc_application', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='verification_images', to='kyc_verification.kycapplication')),
            ],
            options={
                'verbose_name': 'Verification Images',
                'verbose_name_plural': 'Verification Images',
                'db_table': 'kyc_verification_images',
            },
        ),
        migrations.AddIndex(
            model_name='kycapplication',
            index=models.Index(fields=['status', '-created_at'], name='kyc_applica_status_070f1a_idx'),
        ),
        migrations.AddIndex(
            model_name='kycapplication',
            index=models.Index(fields=['application_id'], name='kyc_applica_applica_23f324_idx'),
        ),
        migrations.AddIndex(
            model_name='kycapplication',
            index=models.Index(fields=['user', 'status'], name='kyc_applica_user_id_d80d2b_idx'),
        ),
        migrations.AddIndex(
            model_name='kycauditlog',
            index=models.Index(fields=['kyc_application', '-created_at'], name='kyc_audit_l_kyc_app_483136_idx'),
        ),
        migrations.AddIndex(
            model_name='kycauditlog',
            index=models.Index(fields=['action', '-created_at'], name='kyc_audit_l_action_5fcd05_idx'),
        ),
        migrations.AddIndex(
            model_name='kycauditlog',
            index=models.Index(fields=['performed_by', '-created_at'], name='kyc_audit_l_perform_c7dee9_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='kycprogresstracker',
            unique_together={('kyc_application', 'step_number')},
        ),
        migrations.AddIndex(
            model_name='otpverification',
            index=models.Index(fields=['user', 'otp_type', '-created_at'], name='kyc_otp_ver_user_id_339bea_idx'),
        ),
        migrations.AddIndex(
            model_name='otpverification',
            index=models.Index(fields=['otp_code', 'expires_at'], name='kyc_otp_ver_otp_cod_929e16_idx'),
        ),
    ]
